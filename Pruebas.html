<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ruta de Estudio Inteligente</title>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <style>
    :root {
      --accent: #0b84ff;
      --bg-dark: #07121a;
      --panel-dark: #071826;
      --text-dark: #e6eef6;

      --bg-light: #f5f7fa;
      --panel-light: #ffffff;
      --text-light: #111;
    }

    body {
      margin: 0;
      font-family: "Inter", sans-serif;
      background: var(--bg-dark);
      color: var(--text-dark);
      transition: 0.3s;
    }

    body.light {
      background: var(--bg-light);
      color: var(--text-light);
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 20px;
      background: var(--panel-dark);
    }
    body.light header { background: var(--panel-light); }

    .wrap {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 20px;
      padding: 20px;
    }

    .panel {
      background: var(--panel-dark);
      padding: 16px;
      border-radius: 10px;
    }
    body.light .panel { background: var(--panel-light); }

    input, select {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 8px;
      border: 1px solid #8883;
      background: transparent;
      color: inherit;
    }
    body.light input, body.light select { border: 1px solid #ccc; }

    button {
      padding: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: var(--accent);
      color: white;
      font-weight: bold;
    }

    .theme-btn {
      background: none;
      color: inherit;
      border: 1px solid currentColor;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
    }

    main {
      background: var(--panel-dark);
      padding: 16px;
      border-radius: 10px;
      min-height: 300px;
    }
    body.light main { background: var(--panel-light); }

    iframe { width: 100%; height: 220px; border-radius: 8px; border: none; }
  </style>
</head>
<body>
  <header>
    <h2>Ruta de Estudio Inteligente</h2>
    <button class="theme-btn" id="themeBtn">ðŸŒ™ Oscuro/Claro</button>
  </header>

  <div class="wrap">
    <aside class="panel">
      <label>Tema:</label>
      <input id="topic" type="text" placeholder="Ejemplo: anatomÃ­a humana">

      <label>Proveedor de IA:</label>
      <select id="provider">
        <option value="openai">OpenAI</option>
        <option value="deepseek">DeepSeek</option>
      </select>

      <button id="generate">Generar ruta</button>
      <p id="status" style="font-size:13px;color:gray;"></p>
    </aside>

    <main>
      <h3 id="title">â€”</h3>
      <p id="synopsis"></p>
      <h4>Video sugerido</h4>
      <iframe id="video"></iframe>
    </main>
  </div>

  <script>
    const btnTheme = document.getElementById("themeBtn");
    btnTheme.onclick = () => document.body.classList.toggle("light");

    const topic = document.getElementById("topic");
    const provider = document.getElementById("provider");
    const generate = document.getElementById("generate");
    const status = document.getElementById("status");
    const synopsis = document.getElementById("synopsis");
    const title = document.getElementById("title");
    const video = document.getElementById("video");

    generate.onclick = async () => {
      const t = topic.value.trim();
      if (!t) return alert("Escribe un tema.");
      status.textContent = "Generando ruta...";
      synopsis.textContent = "";
      title.textContent = "Ruta: " + t;

      try {
        const res = await fetch("/api/ia", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ topic: t, provider: provider.value })
        });
        const data = await res.json();
        synopsis.innerHTML = data.text.replace(/\n/g, "<br>");
        status.textContent = "Sinopsis generada.";

        const yt = await fetch("/api/youtube", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ topic: t })
        });
        const vidData = await yt.json();
        const vid = vidData.items?.[0];
        if (vid) video.src = `https://www.youtube.com/embed/${vid.id.videoId}`;
        else video.src = "";
      } catch (err) {
        status.textContent = "Error de conexiÃ³n.";
        console.error(err);
      }
    };
  </script>
</body>
</html>
