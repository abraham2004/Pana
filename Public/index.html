<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ruta de estudio — Generador</title>

  <!-- Mermaid (mapas conceptuales) -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

  <style>
    :root{
      --accent:#0b84ff;
      --bg:#0f1720;
      --panel:#0b1220;
      --card:#0f2030;
      --muted:#9aa7ba;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, system-ui, Arial;
      background:linear-gradient(180deg,#071025 0%, #071b2a 100%);
      color:#e6eef6;
      min-height:100vh;
      padding:28px;
    }
    header{display:flex;gap:16px;align-items:center;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .container{
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:18px;
      align-items:start;
    }

    /* panel izquierdo (control) */
    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:16px;
      box-shadow: 0 6px 18px rgba(2,6,23,0.6);
      min-height:120px;
    }
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="text"]{
      width:100%;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.04);
      background:transparent;
      color:inherit;
      outline:none;
      margin-bottom:10px;
    }
    .controls{display:flex;gap:8px}
    button{
      background:var(--accent);
      color:white;
      padding:10px 12px;
      border-radius:8px;
      border:0;
      cursor:pointer;
      font-weight:600;
      box-shadow: 0 6px 18px rgba(11,132,255,0.12);
    }
    button.secondary{
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      color:var(--muted);
      box-shadow:none;
    }

    /* area principal: mapa de estudio */
    .main{
      min-height:400px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:14px;
      border-radius:12px;
    }
    .route-title{display:flex;align-items:center;gap:10px;margin-bottom:12px}
    .overview{
      background:var(--glass);
      padding:12px;border-radius:10px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.03);
    }

    /* recuadros de recursos */
    .resources{
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(240px,1fr));
      gap:12px;
      margin-bottom:12px;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
      border-radius:10px;
      padding:10px;border:1px solid rgba(255,255,255,0.03);
    }
    .card h3{margin:0 0 6px 0;font-size:15px}
    .card p{margin:0 0 8px 0;color:var(--muted);font-size:13px}
    .card a{color:var(--accent);text-decoration:none;font-weight:600;font-size:13px}

    /* iframe preview (si la página lo permite) */
    .preview{
      width:100%;height:180px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);overflow:hidden;
      background:linear-gradient(180deg,#05121a,#071b26);
      display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:13px;
    }
    .flex-row{display:flex;gap:12px;align-items:flex-start}

    /* area para mapa conceptual y 3D */
    .extras{display:grid;grid-template-columns:1fr 380px;gap:12px;margin-top:12px}
    .mermaid-wrapper{background:var(--card);padding:8px;border-radius:8px;min-height:220px}
    .three-wrapper{background:var(--card);padding:8px;border-radius:8px;min-height:220px}

    footer{margin-top:14px;color:var(--muted);font-size:13px}
    @media (max-width:900px){
      .container{grid-template-columns:1fr}
      .extras{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <header>
    <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36'><rect rx='8' width='36' height='36' fill='%230b84ff'/><text x='50%' y='55%' font-family='Arial' font-size='16' fill='white' text-anchor='middle'>R</text></svg>" alt="" style="width:44px;height:44px;border-radius:8px">
    <div>
      <h1>Generador de ruta de estudio</h1>
      <div style="color:var(--muted);font-size:13px">Escribe tu tema y genera un mapa de estudio con recursos, mapa conceptual y zona 3D.</div>
    </div>
  </header>

  <div class="container">
    <!-- PANEL -->
    <aside class="panel">
      <label for="topic">Tema de estudio</label>
      <input id="topic" type="text" placeholder="Ej.: Redes y Ciberseguridad, Bioquímica, Álgebra" value="">
      <div style="font-size:13px;color:var(--muted);margin-bottom:8px">Opciones:</div>
      <div class="controls">
        <button id="generateBtn">Generar ruta</button>
        <button id="clearBtn" class="secondary">Limpiar</button>
      </div>
      <hr style="margin:12px 0;border:0;border-top:1px solid rgba(255,255,255,0.02)">
      <div style="font-size:13px;color:var(--muted)">
        <strong>Nota:</strong> Algunas páginas podrían bloquear la vista previa. Si pasa, haz clic en el enlace del recurso.
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <div class="route-title">
        <h2 id="titleNow" style="margin:0">Ruta: —</h2>
        <div style="color:var(--muted);font-size:13px;margin-left:auto">Generado localmente</div>
      </div>

      <div id="overview" class="overview">
        <em>Introduce un tema y presiona <strong>Generar ruta</strong>.</em>
      </div>

      <div id="resources" class="resources" aria-live="polite"></div>

      <div class="extras">
        <div class="mermaid-wrapper card">
          <h3 style="margin-top:0">Mapa conceptual</h3>
          <div id="mermaid" class="mermaid">graph LR; A-->B;</div>
        </div>

        <div class="three-wrapper card">
          <h3 style="margin-top:0">Diseño / 3D (incrustable)</h3>
          <div id="threeArea" style="font-size:13px;color:var(--muted)">
            Puedes pegar aquí la URL de un modelo 3D (Sketchfab, p3d.in, myminifactory) y el sistema intentará incrustarlo.
            <div style="margin-top:8px">
              <input id="threeUrl" type="text" placeholder="https://sketchfab.com/..." style="width:100%;padding:8px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
              <button id="embed3d" style="margin-top:8px">Incrustar 3D</button>
            </div>
            <div id="threePreview" class="preview" style="margin-top:8px">Preview 3D aparecerá aquí (si la fuente lo permite)</div>
          </div>
        </div>
      </div>

      <footer>
        Consejo: puedes editar este `index.html` para ampliar generadores, usar APIs (por ejemplo Wikipedia, YouTube) o guardar rutas en localStorage.
      </footer>
    </main>
  </div>

  <script>
    // Inicializa mermaid
    if (window.mermaid) {
      mermaid.initialize({startOnLoad:false, theme: 'neutral'});
    }

    const topicInput = document.getElementById('topic');
    const generateBtn = document.getElementById('generateBtn');
    const clearBtn = document.getElementById('clearBtn');
    const titleNow = document.getElementById('titleNow');
    const overview = document.getElementById('overview');
    const resources = document.getElementById('resources');
    const mermaidDiv = document.getElementById('mermaid');
    const threeUrl = document.getElementById('threeUrl');
    const embed3d = document.getElementById('embed3d');
    const threePreview = document.getElementById('threePreview');

    // Generador básico (local, sin backend)
    generateBtn.addEventListener('click', () => {
      const topic = (topicInput.value || '').trim();
      if (!topic) {
        alert('Escribe un tema de estudio.');
        return;
      }
      titleNow.textContent = `Ruta: ${topic}`;
      buildOverview(topic);
      buildResources(topic);
      buildMermaid(topic);
    });

    clearBtn.addEventListener('click', () => {
      topicInput.value='';
      titleNow.textContent='Ruta: —';
      overview.innerHTML='<em>Introduce un tema y presiona <strong>Generar ruta</strong>.</em>';
      resources.innerHTML='';
      mermaidDiv.innerHTML='graph LR; A-->B;';
      if (window.mermaid) mermaid.init(undefined, mermaidDiv);
      threePreview.innerHTML='Preview 3D aparecerá aquí (si la fuente lo permite)';
      threeUrl.value='';
    });

    // Construye un párrafo de overview simple (puedes ampliar con llamadas a APIs)
    function buildOverview(topic){
      overview.innerHTML=`
        <strong>Descripción rápida:</strong>
        <p style="margin:8px 0;color:var(--muted)">Plan de estudio para <strong>${escapeHtml(topic)}</strong>. Esta ruta organiza: conceptos clave, lecturas introductorias, prácticas (ejercicios), recursos multimedia y, si aplica, modelos / diagramas 3D para entender estructuras o dispositivos.</p>
        <p style="margin:0;color:var(--muted)"><strong>Estrategia sugerida:</strong> 1) Fundamentos (2–3 horas), 2) Conceptos intermedios (4–6 horas), 3) Práctica + proyectos (varias sesiones), 4) Repaso activo y autoevaluación.</p>
      `;
    }

    // Genera tarjetas de recursos: Wikipedia, búsqueda, vídeos y ejemplo de curso
    function buildResources(topic){
      const q = encodeURIComponent(topic);
      const cards = [
        {
          title:'Breve lectura — Wikipedia',
          desc:`Resumen introductorio sobre ${topic}.`,
          url:`https://es.wikipedia.org/wiki/Special:Search?search=${q}`
        },
        {
          title:'Búsqueda rápida — Google',
          desc:`Búsqueda web para encontrar tutoriales y artículos.`,
          url:`https://www.google.com/search?q=${q}`
        },
        {
          title:'Videos (YouTube)',
          desc:'Playlist y videos explicativos.',
          url:`https://www.youtube.com/results?search_query=${q}`
        },
        {
          title:'Curso / Tutorial recomendado',
          desc:'Ejemplo: busca cursos en platforma como Coursera/edX/YouTube.',
          url:`https://www.google.com/search?q=${q}+curso`
        }
      ];

      // Limpia y añade
      resources.innerHTML='';
      cards.forEach(c=>{
        const el = document.createElement('div');
        el.className='card';
        el.innerHTML = `<h3>${c.title}</h3><p>${c.desc}</p><a href="${c.url}" target="_blank" rel="noopener noreferrer">${c.url}</a>
          <div style="margin-top:8px;" class="preview-wrap">
            <div class="preview" data-url="${c.url}">Vista previa: intentar incrustar</div>
          </div>`;
        resources.appendChild(el);

        // Intenta añadir iframe si la página permite
        const preview = el.querySelector('.preview');
        tryEmbed(preview, c.url);
      });

      // práctica sugerida
      const practiceCard = document.createElement('div');
      practiceCard.className='card';
      practiceCard.innerHTML = `<h3>Práctica recomendada</h3>
        <p style="color:var(--muted)">Tarea corta y proyecto final sugerido para aplicar lo aprendido.</p>
        <ul style="margin:6px 0 0 16px;color:var(--muted)"><li>Ejercicio 1: resumen y mapa conceptual.</li><li>Ejercicio 2: mini-proyecto o problema práctico.</li><li>Autoevaluación: cuestionario de 10–20 preguntas.</li></ul>`;
      resources.appendChild(practiceCard);
    }

    // Intento inteligente de incrustar: crea <iframe> sólo si el dominio no lo bloquea (no podemos comprobarlo sin intentar)
    function tryEmbed(previewEl, url){
      // Mostramos un iframe y capturamos error de carga (si se bloquea, mostramos enlace)
      const iframe = document.createElement('iframe');
      iframe.src = url;
      iframe.style.width='100%';
      iframe.style.height='100%';
      iframe.style.border='0';
      iframe.loading='lazy';
      iframe.sandbox='allow-same-origin allow-popups allow-forms allow-scripts';
      // timeout: si no carga en X ms, la mayoría de páginas bloqueadas se quedarán en blanco; manejamos error con un timer
      let loaded=false;
      iframe.onload = () => {
        loaded=true;
      };
      // Insert iframe, y tras 1200ms si no load, lo retiramos y mostramos enlace
      previewEl.innerHTML=''; previewEl.appendChild(iframe);
      setTimeout(()=>{
        if (!loaded){
          previewEl.innerHTML = `<div style="padding:12px;text-align:center;color:var(--muted)">No se pudo mostrar la vista previa. <a href="${url}" target="_blank" rel="noopener noreferrer" style="color:var(--accent)">Abrir recurso</a></div>`;
        }
      },1200);
    }

    // Construye un diagrama mermaid simple basado en el tema
    function buildMermaid(topic){
      const sanitized = topic.replace(/[^a-zA-Z0-9\s]/g,'').split(' ').slice(0,3).join('_');
      // Ejemplo generador: divide en 4 nodos generales
      const nodes = [
        {id:'A', label:'Fundamentos'},
        {id:'B', label:'Conceptos intermedios'},
        {id:'C', label:'Prácticas / Proyectos'},
        {id:'D', label:'Repaso & Autoevaluación'}
      ];
      const md = `graph LR
        A["Fundamentos"] --> B["Conceptos intermedios"]
        B --> C["Prácticas / Proyectos"]
        C --> D["Repaso & Autoevaluación"]
        A --> C
        click A "https://es.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(topic)}" "Ir a lectura"
        click B "https://www.google.com/search?q=${encodeURIComponent(topic+' conceptos clave')}" "Buscar conceptos"
      `;
      mermaidDiv.innerHTML = md;
      if (window.mermaid) mermaid.init(undefined, mermaidDiv);
    }

    // Helpers
    function escapeHtml(s){ return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    // 3D embed button
    embed3d.addEventListener('click', () => {
      const url = (threeUrl.value || '').trim();
      if (!url) return alert('Pega la URL del modelo 3D (ej.: Sketchfab).');
      // Sketchfab embed pattern
      if (url.includes('sketchfab.com')) {
        // user may paste the model page; embed iframe with embed URL pattern
        // Sketchfab embed requires the /models/{id}/embed endpoint. We'll try to extract the id.
        const m = url.match(/sketchfab.com\/(?:3d-models\/)?([^\/?#]+)/i);
        if (m && m[1]) {
          const id = m[1];
          const src = `https://sketchfab.com/models/${id}/embed`;
          threePreview.innerHTML='';
          const iframe = document.createElement('iframe');
          iframe.src = src;
          iframe.style.width='100%';
          iframe.style.height='100%';
          iframe.style.border='0';
          threePreview.appendChild(iframe);
          return;
        }
      }
      // fallback: try generic iframe
      const iframe = document.createElement('iframe');
      iframe.src = url;
      iframe.style.width='100%';
      iframe.style.height='100%';
      iframe.style.border='0';
      threePreview.innerHTML=''; threePreview.appendChild(iframe);
      setTimeout(()=> {
        // if blank or blocked, show link
        if (threePreview.innerText.trim().length === 0) {
          threePreview.innerHTML = `<div style="padding:12px;color:var(--muted)">No fue posible incrustar. <a href="${url}" target="_blank" rel="noopener noreferrer" style="color:var(--accent)">Abrir modelo 3D</a></div>`;
        }
      },900);
    });
  </script>
</body>
</html>
